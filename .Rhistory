ranklabel = "orders"
} else if(rank == "Family") {
dt[, id := as.numeric(factor(Families, levels = unique(Families)))]
ranklabel = "families"
} else if(rank == "Genus") {
dt[, id := as.numeric(factor(Genera, levels = unique(Genera)))]
ranklabel = "genera"
} else if(rank == "Species") {
dt[, id := as.numeric(factor(AphiaIDs, levels = unique(AphiaIDs)))]
ranklabel = "species"
}
setkey(dt, "year", "id")
dt.out <- dt[J(unique(year)), mult = "last"]#[, Phylum := NULL]
dt.out[, id := cummax(id)]
numtaxa <- cummax(as.numeric(factor(dt$id)))
taxa_dt <- aggregate(numtaxa, list(year = dt$year), max )
colnames(taxa_dt) <- c("year", "taxacount")
max_found <- max(taxa_dt[,2])
N_obs <- taxa_dt$'taxacount'
times <- c(taxa_dt$year)
model <- suppressWarnings(drm(N_obs ~ times, data = data.frame(N_obs = N_obs, times = times), fct = L.4()))
maxi = round(coef(summary(model))[3], digits = 0)
rest = maxi - max_found
#rest = maxi = max_obs
phase1 = "A logistic regression model predicts there exists"
phase2 = "of"
phase3 = "in this region."
phase4 = "have been found and"
phase5 = "remain to be discovered."
phase6 = "remains to be discovered."
if(rest > 1) {
complete_phase = paste(phase1, maxi, ranklabel, phase2, taxa, phase3, max_found, ranklabel, phase4, rest, phase5, sep = " ")
} else {
complete_phase = paste(phase1, maxi, ranklabel, phase2, taxa, phase3, max_found, ranklabel, phase4, "none", phase6, sep = " ")
}
return(complete_phase)
}#, error = function(e) {list(taxa = taxa, rank = rankabel, method = method, corr_coef = cat("model fails to converge", "\n"))}
)
}
taxamodel("Chordata", "Class", "logistic")
taxa_rich("Chordata", "Order")
taxamodel("Chordata", "Order", "logistic")
taxamodel("Chordata", "Class", "logistic")
taxa_rich("Chordata", "Family")
taxa_rich("Chordata", "Family")
taxa_rich("Chordata", "Genus")
taxa_rich("Chordata", "Order")
taxa_rich <- function(taxa, rank) {
tryCatch({
data_m <- subset(data_m, Kingdoms != "" & Phyla != "" & Classes != "" & Orders != "" & Families != "" & Genera != "" & AphiaIDs != "")
df <- subset(data_m, Kingdoms == taxa | Phyla == taxa | Classes == taxa | Orders == taxa | Families == taxa | Genera == taxa)
dt = as.data.table(unique(df))
setkey(dt, "year")
if(rank == "Phylum") {
dt[, id := as.numeric(factor(Phyla, levels = unique(Phyla)))]
ranklabel = "phyla"
} else if(rank == "Class") {
dt[, id := as.numeric(factor(Classes, levels = unique(Classes)))]
ranklabel = "classes"
} else if(rank == "Order") {
dt[, id := as.numeric(factor(Orders, levels = unique(Orders)))]
ranklabel = "orders"
} else if(rank == "Family") {
dt[, id := as.numeric(factor(Families, levels = unique(Families)))]
ranklabel = "families"
} else if(rank == "Genus") {
dt[, id := as.numeric(factor(Genera, levels = unique(Genera)))]
ranklabel = "genera"
} else if(rank == "Species") {
dt[, id := as.numeric(factor(AphiaIDs, levels = unique(AphiaIDs)))]
ranklabel = "species"
}
setkey(dt, "year", "id")
dt.out <- dt[J(unique(year)), mult = "last"]#[, Phylum := NULL]
dt.out[, id := cummax(id)]
numtaxa <- cummax(as.numeric(factor(dt$id)))
taxa_dt <- aggregate(numtaxa, list(year = dt$year), max )
colnames(taxa_dt) <- c("year", "taxacount")
max_found <- max(taxa_dt[,2])
N_obs <- taxa_dt$'taxacount'
times <- c(taxa_dt$year)
model <- suppressWarnings(drm(N_obs ~ times, data = data.frame(N_obs = N_obs, times = times), fct = L.4()))
maxi = round(coef(summary(model))[3], digits = 0)
rest = maxi - max_found
#rest = maxi = max_obs
phase1 = "A logistic regression model predicts there exists"
phase2 = "of"
phase3 = "in this region."
phase4 = "have been found and"
phase5 = "remain to be discovered."
phase6 = "remains to be discovered."
if(rest > 1) {
complete_phase = paste(phase1, maxi, ranklabel, phase2, taxa, phase3, max_found, ranklabel, phase4, rest, phase5, sep = " ")
} else if (rest < 1) {
complete_phase = paste(phase1, maxi, ranklabel, phase2, taxa, phase3, max_found, ranklabel, phase4, "none", phase6, sep = " ")
} else {
complete_phase = paste(phase1, maxi, ranklabel, phase2, taxa, phase3, max_found, ranklabel, phase4, rest, phase6, sep = " ")
}
return(complete_phase)
}#, error = function(e) {list(taxa = taxa, rank = rankabel, method = method, corr_coef = cat("model fails to converge", "\n"))}
)
}
taxa_rich("Chordata", "Order")
devtools::document()
devtools::check()
library(biotaxa)
library(biotaxa)
taxa_rich("Chordata", "Genus")
taxa_rich("Chordata", "Species")
devtools::document()
devtools::check()
library(robis)
library(rgbif)
library(biotaxa)
taxa_rich("Chordata", "Species")
taxa_rich("Chordata", "Order")
taxa_rich("Salpidae", "Genus")
taxa_rich("Salpidae", "Species")
taxa_rich("Coccinellidae", "Species")
taxa_rich("Formicidae", "Species")
taxa_rich("Hymenoptera", "Species")
taxamodel("Hymenoptera", "Species", "logistic")
taxamodel("Hymenoptera", "Genus", "logistic")
taxa_rich("Hymenoptera", "Genus")
taxa_rich("Coleoptera", "Genus")
taxa_rich("Coleoptera", "Species")
taxamodel("Coleoptera", "Genus")
taxamodel("Coleoptera", "Genus", "logistic")
taxamodel("Coleoptera", "Species", "logistic")
taxamodel("Hymenooptera", "Species", "logistic")
taxamodel("Hymenoptera", "Species", "logistic")
taxamodel("Hymenoptera", "Genus", "logistic")
taxamodel("Leoptera", "Genus", "logistic")
taxamodel("Homoptera", "Genus", "logistic")
taxamodel("Hemiptera", "Genus", "logistic")
taxamodel("Hemiptera", "Species", "logistic")
taxa_rich("Hemipgera", "Species", "logistic")
taxa_rich("Hemipgera", "Species")
taxa_rich("Hemipgera", "species")
taxa_rich("Hemiptera", "Species")
taxa_rich("Hemiptera", "Genus")
taxa_rich("Hemiptera", "Family")
taxa_rich("Lepidoptera", "Family")
taxa_rich("Lepidoptera", "Genus")
taxa_rich("Lepidoptera", "Species")
taxa_rich("Lepidoptera", "Species")
taxa_rich("Odonata", "Species")
spetaxalist("Lepidoptera", "Species")
spetaxalist()
?spetaxalist
spetaxalist(data_m, "Order")
taxa_rich("Thuidales", "Genus")
taxa_rich("Thuidales", "Species")
taxa_rich("Spionida", "Species")
taxamodel("Spionida", "Species", "logistic")
taxa_rich("Spionida", "Genus")
taxa_rich("Spionida", "Family")
taxa_rich("Spionida", "Order")
taxa_rich("Salpida", "Order")
taxa_rich("Salpida", "Family")
taxa_rich("Salpida", "Genus")
taxa_rich("Salpida", "Species")
taxa_rich("Tryblidiida", "Species")
taxamodel("Tryblidiida", "Species")
taxamodel("Tryblidiida", "Species", "logistic")
alltaxalist(data_m)
data_m %>% filter("Salpida")
head(alltaxalist(data_m = data_m = ))
head(alltaxalist(data_m = data_m))
data_m %>% filter(taxa == "Salpidae")
data_m %>% filter(taxa = "Salpidae")
data_m %>% filter(taxa = "Salpida")
data_m %>% filter("Salpida")
data_m %>% filter(taxa = "Salpidae")
data_m %>% filter(taxa == "Salpidae")
colnames(data_m)
ls <- alltaxalist(data_m)
colnames(ls)
ls %>% filter(taxa == "Salpida")
ls %>% filter(taxa == "Salpida")$rank
ls %>% filter(taxa == "Salpida")
taxa_query <- function(taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa)
ls$rank
}
taxa_query("Salpida")
alltaxalist(data_m) %>% filter("Salpida")
alltaxalist(data_m) %>% filter(taxa == "Salpida")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
ls$rank
}
taxa_query("Salpida")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
ls$rank[1]
}
taxa_query("Salpida")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
as.character(ls$rank[1])
}
taxa_query("Salpida")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- as.character(ls$rank[1])
paste(taxa, "is a", out_rank, ".", sep = " ")
}
taxa_query("Salpida")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- as.character(ls$rank[1])
paste(taxa, "is a", out_rank, ".", sep = " ")
}
taxa_query("Salpida")
alltaxalist(data_m) %>% filter(taxa == in_taxa)
alltaxalist(data_m) %>% filter(taxa == "Salpida")
l <- alltaxalist(data_m) %>% filter(taxa == "Salpida")
l
l$rank
as.character(ls$rank)
as.character(ls$rank)[1]
as.character(l$rank)[1]
as.character(l$rank)
paste("", "is a", out_rank, ".", sep = " ")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- as.character(ls$rank)
paste(in_taxa, "is a", out_rank, ".", sep = " ")
}
taxa_query("Salpida")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- as.character(ls$rank)
paste(in_taxa, " is a ", out_rank,"", sep = "")
}
taxa_query("Salpida")
taxa_query("Hymenoptera")
taxa_query("Formicidae")
taxa_query("Mollusca")
taxa_query("Animalia")
letters("P")
letter("p")
letter("P")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- as.character(ls$rank)
paste(in_taxa, " is a ", out_rank,".", sep = "")
}
taxa_query("Animalia")
taxa_query("Bacteria")
taxa_query("Arthropoda")
taxa_query("Lepidoptera")
taxa_query("Collembola")
taxa_rich("Collembola", "Genus")
taxa_rich("Collembola", "Species")
taxamodel("Collembola", "Species", "logistic")
#' @return the predicted value of taxa richness (of given rank) based on logistic regression model
#' @import data.table
#' @importFrom stats getInitial
#' @import drc
#' @examples
#' \dontrun{
#' taxa_rich("Animalia", "Phylum")
#' }
#' @export
#'
taxa_rich <- function(taxa, rank) {
tryCatch({
data_m <- subset(data_m, Kingdoms != "" & Phyla != "" & Classes != "" & Orders != "" & Families != "" & Genera != "" & AphiaIDs != "")
df <- subset(data_m, Kingdoms == taxa | Phyla == taxa | Classes == taxa | Orders == taxa | Families == taxa | Genera == taxa)
dt = as.data.table(unique(df))
setkey(dt, "year")
if(rank == "Phylum") {
dt[, id := as.numeric(factor(Phyla, levels = unique(Phyla)))]
ranklabel = "phyla"
} else if(rank == "Class") {
dt[, id := as.numeric(factor(Classes, levels = unique(Classes)))]
ranklabel = "classes"
} else if(rank == "Order") {
dt[, id := as.numeric(factor(Orders, levels = unique(Orders)))]
ranklabel = "orders"
} else if(rank == "Family") {
dt[, id := as.numeric(factor(Families, levels = unique(Families)))]
ranklabel = "families"
} else if(rank == "Genus") {
dt[, id := as.numeric(factor(Genera, levels = unique(Genera)))]
ranklabel = "genera"
} else if(rank == "Species") {
dt[, id := as.numeric(factor(AphiaIDs, levels = unique(AphiaIDs)))]
ranklabel = "species"
}
setkey(dt, "year", "id")
dt.out <- dt[J(unique(year)), mult = "last"]#[, Phylum := NULL]
dt.out[, id := cummax(id)]
numtaxa <- cummax(as.numeric(factor(dt$id)))
taxa_dt <- aggregate(numtaxa, list(year = dt$year), max )
colnames(taxa_dt) <- c("year", "taxacount")
max_found <- max(taxa_dt[,2])
N_obs <- taxa_dt$'taxacount'
times <- c(taxa_dt$year)
model <- suppressWarnings(drm(N_obs ~ times, data = data.frame(N_obs = N_obs, times = times), fct = L.4()))
maxi = round(coef(summary(model))[3], digits = 0)
rest = maxi - max_found
#rest = maxi = max_obs
phase1 = "A logistic regression model predicts there exists"
phase2 = "of"
phase3 = "in this region."
phase4 = "have been found and"
phase5 = "remain to be discovered."
phase6 = "remains to be discovered."
if(rest > 1) {
complete_phase = paste(phase1, maxi, ranklabel, phase2, taxa, phase3, max_found, ranklabel, phase4, rest, phase5, sep = " ")
} else if (rest < 1) {
complete_phase = paste(phase1, maxi, ranklabel, phase2, taxa, phase3, max_found, ranklabel, phase4, "none", phase6, sep = " ")
} else {
complete_phase = paste(phase1, maxi, ranklabel, phase2, taxa, phase3, max_found, ranklabel, phase4, rest, phase6, sep = " ")
}
return(complete_phase)
}#, error = function(e) {list(taxa = taxa, rank = rankabel, method = method, corr_coef = cat("model fails to converge", "\n"))}
)
}
taxa_rich("Collembola", "Species")
alltaxalist(data_m )
taxa_rich("Coccosphaerales","Species")
taxa_rich("Coccosphaerales","Species")
taxa_rich("Collembola","Species")
taxa_rich("Collembola","Species")
taxa_rich("Coleoptera","Species")
taxa_query("Coleoptera")
devtools::document()
devtools::check()
devtools::build()
strsplit("test", "a")
?strsplit
sub("test")
sub("test", "t")
"test"[1]
"test"[2]
length(split("test"))
?split
x <- "test"
strplit(x, "")
strsplit(x, "")
strsplit(x, " ")
strsplit(x, "")
strsplit(x, "")[[1]][2]
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- as.character(ls$rank)
if((strsplit(in_taxa, ""))[[1]][1] == "O") {
paste(in_taxa, " is an ", out_rank,".", sep = "")
} else {
paste(in_taxa, " is a ", out_rank,".", sep = "")
}
}
taxa_query("Animalia")
taxa_query("Mollusca")
taxa_query("Hymenoptera")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- as.character(ls$rank)
if((strsplit(out_rank, ""))[[1]][1] == "O") {
paste(in_taxa, " is an ", out_rank,".", sep = "")
} else {
paste(in_taxa, " is a ", out_rank,".", sep = "")
}
}
taxa_query("Hymenoptera")
devtools::document()
taxa_query("Salpida")
taxa_query("Salpidae")
taxa_query("Plantae")
taxa_rich("Plantae", "Species")
taxa_rich("Bacteria", "Species")
taxa_rich("Bacteria", "Genus")
taxa_rich("Bacteria", "Family")
taxa_rich("Bacteria", "Order")
taxa_rich("Bacteria", "Class")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- tolower(as.character(ls$rank))
if((strsplit(out_rank, ""))[[1]][1] == "O") {
paste(in_taxa, " is an ", out_rank, ".", sep = "")
} else {
paste(in_taxa, " is a ", out_rank, ".", sep = "")
}
}
taxa_query("Salpida")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- tolower(as.character(ls$rank))
if((strsplit(out_rank, ""))[[1]][1] == "O") {
paste(in_taxa, " is an ", out_rank, ".", sep = "")
} else {
paste(in_taxa, " is a ", out_rank, ".", sep = "")
}
}
taxa_query("123")
taxa_query(c("Salpida", "Coleoptera"))
lapply(c("Salpida", "Coleoptera"), taxa_query)
unlist(lapply(c("Salpida", "Coleoptera"), taxa_query))
writeLines(lapply(c("Salpida", "Coleoptera"), taxa_query))
lapply(c("Salpida", "Coleoptera"), taxa_query)
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- tolower(as.character(ls$rank))
if((strsplit(out_rank, ""))[[1]][1] == "o") {
paste(in_taxa, " is an ", out_rank, ".", sep = "")
} else {
paste(in_taxa, " is a ", out_rank, ".", sep = "")
}
}
lapply(c("Salpida", "Coleoptera"), taxa_query)
as.factor(unlist(lapply(c("Salpida", "Coleoptera"), taxa_query)))
as.vector(unlist(lapply(c("Salpida", "Coleoptera"), taxa_query)))
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- tolower(as.character(ls$rank))
if((strsplit(out_rank, ""))[[1]][1] == "o") {
paste(in_taxa, " is an ", out_rank, ".", sep = "")
} else {
writeLines(paste(in_taxa, " is a ", out_rank, ".", sep = ""))
}
}
lapply(c("Salpida", "Animalia"), taxa_query)
writeLines("Animalia")
taxa_query("Animalia")
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- tolower(as.character(ls$rank))
if((strsplit(out_rank, ""))[[1]][1] == "o") {
writeLines(paste(in_taxa, " is an ", out_rank, ".", sep = ""))
} else {
writeLines(paste(in_taxa, " is a ", out_rank, ".", sep = ""))
}
}
lapply(c("Animalia", "Arthropoda"), taxa_query)
data_m %>% filter("Salpida") %select("Phylum")
data_m %>% filter("Salpida") %>% select("Phylum")
data_m %>% filter("Salpida") %>% select("Phyla")
data_m %>% filter("Salpida")
head(data_m)
data_m %>% filter(Order == "Sapida")
data_m %>% filter(Orders == "Sapida")
data_m %>% filter(Orders == "Salpida")
data_m %>% filter(Orders == "Salpida") %>% select("Phylum", "Class")
data_m %>% filter(Orders == "Salpida") %>% select("Phylum", "Classes")
data_m %>% filter(Orders == "Salpida") %>% select("Phyla", "Classes")
colnames(data_m)
data_m %>% filter(Orders == "Salpida")
data_m %>% filter(Orders == "Salpida") %>% select("Phyla")
data_m %>% filter(Orders == "Salpida") %>% select(Phyla)
data_m %>% filter(Orders == "Salpida") %>% select(AphiaIDs)
data_m %>% filter(Orders == "Salpida") %>% select(AphiaIDs, Phyla)
data_m %>% filter(Orders == "Salpida")
data_m %>% filter(Orders == "Salpida") %>% select(Families)
library(dplyr)
data_m %>% filter(Orders == "Salpida") %>% select(Families)
dm <- data_m %>% filter(Orders == "Salpida")
dm %>% select(Phyla)
dm %>% group_by(Orders)
dm %>% group_by(Families)
dm %>% group_by(Families) %>% select(year)
dm %>% group_by(Families) %>% summarize(sum = n())
dm %>% group_by(Genera) %>% summarize(sum = n())
dim(dm)
dm %>% group_by("Kingdom") %>% summarize_each()
summarize_each()
dplyr::summarize_each()
?summarize
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- tolower(as.character(ls$rank))
if((strsplit(out_rank, ""))[[1]][1] == "o") {
paste(in_taxa, " is an ", out_rank, ".", sep = "")
} else {
paste(in_taxa, " is a ", out_rank, ".", sep = "")
}
}
taxa_query("Salpidae")
taxa_query("Salpida")
taxa_query("Hymenoptera")
alltaxalist(data_m) %>% filter(taxa == "Salpida") %>% summarise(nspecies = length(unique(Species)))
alltaxalist(data_m) %>% filter(taxa == "Salpida") %>% summarise(nspecies = length(unique(Families)))
alltaxalist(data_m) %>% filter(taxa == "Salpida")
data_m %>% filter(taxa == "Salpida") %>% select(Phyla)
data_m %>% filter(Orders == "Salpida") %>% select(Phyla)
data_m %>% filter(Orders == "Salpida")
?select
data_m %>% filter(Orders == "Salpida") %>% select(year)
data_m %>% filter(Orders == "Salpida") %>% select(data_m, year)
iris <- as_tibble(iris)
iris
select(iris, Species)
library(dplyr)
iris <- as_tibble(iris)
select(iris, Species)
rm(list = ls())
library(dplyr)
iris <- as_tibble(iris)
select(iris, Species)
taxa_query <- function(in_taxa) {
ls <- alltaxalist(data_m) %>% filter(taxa == in_taxa)
out_rank <- tolower(as.character(ls$rank))
if((strsplit(out_rank, ""))[[1]][1] == "o") {
paste(in_taxa, " is an ", out_rank, ".", sep = "")
} else {
paste(in_taxa, " is a ", out_rank, ".", sep = "")
}
}
taxa_query("Salpida")
