{
    "collab_server" : "",
    "contents" : "setwd(\"/Users/hhsieh/Documents/ANTABIS/RASp/RAS species list/Three Bigs/WorMS_ambigous_Matched/Matched csv files/Further Treatments For Editors and Analyses\")\nlist.files()\ndd <- read.csv(\"worms_match_undecided_genusmatchagain_matched_unmatchedresults.csv\", header = T, sep = \",\")\nhead(dd)\ncolnames(dd)\nscinames <- as.character(dd$X.sci_name_1..)\ntaxonranks <- as.character(dd$X.taxonRank..)\nauthories <- as.character(dd$X.authority..)\nsources <- as.character(dd$X.source..)\nscinames_authorities <- as.character(dd$X.sciname_authority.)\nscinames_authorities\n#regular expression to remove the three quotations of strings of scientific names\n\nthreequotations_remover <- function(string) {\n  gsub('\"\"\"', '', string)\n}\nscinames <- lapply(scinames, threequotations_remover)\nscinames <- unlist(scinames)\n\ntaxonranks <- lapply(taxonranks, threequotations_remover)\ntaxonranks <- unlist(taxonranks)\ntaxonranks\n\nauthorities <- lapply(authories, threequotations_remover)\nauthorities <- unlist(authorities)\nauthorities\n\nsources <- lapply(sources, threequotations_remover)\nsources <- unlist(sources)\nsources\n\nchar_remover <- function(string) {\n  gsub('\\\"*\\\"', '', string)\n}\n\nscinames_authorities <- lapply(scinames_authorities, char_remover)\nscinames_authorities <- unlist(scinames_authorities)\nscinames_authorities\n\nnewdd <- cbind(taxonranks, authorities, sources, scinames, scinames_authorities)\nhead(newdd)\ncolnames(newdd) <- c(\"taxonrank\", \"authority\", \"source\", \"sciname\", \"sciname_authority\")\nhead(newdd)\n\nwrite.csv(newdd, \"newdd.csv\", row.names = FALSE)\nnewdd <- read.csv(\"/Users/hhsieh/Documents/ANTABIS/RASp/RAS species list/Three Bigs/WorMS_ambigous_Matched/Matched csv files/Further Treatments For Editors and Analyses/newdd.csv\", sep = \",\", header = T)\n\n# Match OBIS references\nOBIS_ <- read.csv(\"/Users/hhsieh/Documents/ANTABIS/RASp/RAS species list/Final Steps for WoRMS/OBIS unmatche by WoRMS/distinct_OBIS_scinames_all.csv\")\ncolnames(OBIS_)\ndim(OBIS_)\n\nnew_ <- data.frame(sciname = newdd$sciname,\n  authority_obis = OBIS_[match(newdd$sciname,\n    OBIS_$tname), 6],\n  refname_obis = OBIS_[match(newdd$sciname,\n    OBIS_$tname), 8],\n  resourceid_obis = OBIS_[match(newdd$sciname, OBIS_$tname), 7]\n)\n\nhead(new_)\ndim(new_)\n\nnew_ <- cbind(taxonranks, authorities, sources,scinames_authorities, new_)\nwrite.csv(new_, \"/Users/hhsieh/Documents/ANTABIS/RASp/RAS species list/Three Bigs/WorMS_ambigous_Matched/Matched csv files/Further Treatments For Editors and Analyses/new_.csv\", row.names = FALSE)\n\nnew_ <- read.csv(\"/Users/hhsieh/Documents/ANTABIS/RASp/RAS species list/Three Bigs/WorMS_ambigous_Matched/Matched csv files/Further Treatments For Editors and Analyses/new_.csv\", sep = \",\", header = T)\ncolnames(new_)\n\nGBIF_ <- read.csv(\"/Users/hhsieh/Documents/ANTABIS/RASp/RAS species list/Final Steps for WoRMS/Unique GBIF ScientificNames/final_merged_allGBIF_uniques.csv\", sep = \",\", header = T, row.names = NULL)\n\nnew2_ <- data.frame(new_$sciname,\n  authority_GBIF = GBIF_[match(new_$sciname,\n    GBIF_$scientificName), 15],\n  GBIF_datasource= GBIF_[match(new_$sciname,\n    GBIF_$scientificName), 1],\n  GBIF_dataorg = GBIF_[match(new_$sciname, GBIF_$scientificName), 2]\n)\n\ndim(new2_)\ndim(new_)\nnew2_ <- cbind(new_, new2_)\ncolnames(new2_)\n\nwrite.csv(new2_, \"/Users/hhsieh/Documents/ANTABIS/RASp/RAS species list/Three Bigs/WorMS_ambigous_Matched/Matched csv files/Further Treatments For Editors and Analyses/new2_.csv\", row.names = FALSE)\n\n## Now, fetch GBIF dataset citations by API and GBIF dataset keys\nlibrary(\"RJSONIO\")\nlibrary(\"RCurl\")\n\nkeys <- new2_$GBIF_datasource\n\ngetCitation <- function(key) {\n  durl <- paste(\"http://api.gbif.org/v1/dataset/\", key, sep = \"\")\n  if(durl != \"http://api.gbif.org/v1/dataset/NA\") {\n    res <- fromJSON(durl)\n    res$citation\n  } else {\n    res = \"\"\n    res\n  }\n}\n\ncitations <- lapply(keys, getCitation)\ncitations <- as.character(citations)\n\ndistiller <- function(citation) {\n  strsplit(citation, split = \" Occurrence Dataset\", fixed = TRUE)[[1]][1]\n}\n\ncitations_distilled <- lapply(citations, distiller)\ncitations_distilled <- unlist(citations_distilled)\n\nnew3_ <- cbind(new2_, citations_distilled)\ntail(new3_)\ncolnames(new3_)[13] <- \"citation_GBIF\"\n\nwrite.csv(new3_, \"/Users/hhsieh/Documents/ANTABIS/RASp/RAS species list/Three Bigs/WorMS_ambigous_Matched/Matched csv files/Further Treatments For Editors and Analyses/9_ambiguouslymatched_yet_failedtoselectfromWoRMScandidates.csv\", row.names = FALSE)\n",
    "created" : 1504807456753.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "117219484",
    "id" : "38E16693",
    "lastKnownWriteTime" : 1504815282,
    "last_content_update" : 1504815282217,
    "path" : "~/Documents/ANTABIS/RASp/RAS species list/Three Bigs/WorMS_ambigous_Matched/Matched csv files/Further Treatments For Editors and Analyses/datacleaning_refmatches.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled2"
    },
    "relative_order" : 10,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}